{% extends "base.html" %}

{% block content %}


    <div class="container my-5">
        <h1 class="text-center">âš”ï¸ VÃ½sledek Souboje âš”ï¸</h1>
        
        {% if fight_log %}
            
            {% comment %} Sekce s celkovÃ½m vÃ½sledkem {% endcomment %}
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h2>{{ fight_log.boss.name }} â€“ {{ fight_log.get_outcome_display }}</h2>
                </div>
                <div class="card-body">
                    <p><strong>ÄŒas souboje:</strong> {{ fight_log.fight_time|date:"d.m.Y H:i:s" }}</p>
                    <p><strong>PoÄet hrÃ¡ÄÅ¯:</strong> {{ fight_log.player_count }}</p>
                    <p><strong>Celkem udÄ›leno poÅ¡kozenÃ­ hrÃ¡Äi:</strong> {{ fight_log.total_damage_dealt_by_players }}</p>
                    <p><strong>Celkem utrpÄ›no poÅ¡kozenÃ­ hrÃ¡Äi:</strong> {{ fight_log.total_damage_received_by_players }}</p>
                    <p><strong>KoneÄnÃ© HP Bosse:</strong> {{ fight_log.final_boss_hp }}</p>
                    
                    {% if fight_log.outcome == 'players' %}
                        <p class="h4 text-success">ğŸ‰ VÃTÄšZSTVÃ HRÃÄŒÅ®! Boss byl poraÅ¾en. ğŸ‰</p>
                    {% else %}
                        <p class="h4 text-danger">ğŸ’€ BOSS VÃTÄšZÃ! VÅ¡ichni hrÃ¡Äi byli poraÅ¾eni. ğŸ’€</p>
                    {% endif %}
                </div>
            </div>

            <hr>

            {# Sekce s detailnÃ­m prÅ¯bÄ›hem souboje (Log tahÅ¯) #}
            <h2 class="mt-5 mb-3">ğŸ“œ DetailnÃ­ PrÅ¯bÄ›h Souboje (Tah za Tahem)</h2>

            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Tah</th>
                        <th>ÃštoÄnÃ­k</th>
                        <th>CÃ­l</th>
                        <th>PoÅ¡kozenÃ­</th>
                        <th>HP Bosse Po</th>
                        <th>HP CÃ­le Po</th>
                    </tr>
                </thead>
                <tbody>
                    {% for turn in fight_log.turn_logs.all %}
                        <tr>
                            <td>{{ turn.turn_number }}</td>
                            
                            <td>
                                {% if turn.attacker_is_boss %}
                                    <strong>{{ fight_log.boss.name }}</strong>
                                {% else %}
                                    {{ turn.attacker_player.name }}
                                {% endif %}
                            </td>

                            <td>
                                {% if not turn.attacker_is_boss %}
                                    {{ fight_log.boss.name }}
                                {% else %}
                                    {{ turn.target_player.name }}
                                {% endif %}
                            </td>
                            
                            <td class="fw-bold">{{ turn.damage_dealt }}</td>
                            <td>{{ turn.boss_hp_after }}</td>
                            <td>
                                {% if turn.target_player_hp_after is not None %}
                                    {{ turn.target_player_hp_after }}
                                {% else %}
                                    â€”
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>

        {% else %}
            <div class="alert alert-warning" role="alert">
                Pro souboj nebyly nalezeny Å¾Ã¡dnÃ© logy. SpusÅ¥te prosÃ­m souboj.
            </div>
        {% endif %}

    </div>

{% endblock content %}